# Build configuration file for Circle CI
# needs to be named `circle.yml` and should be in the top level dir of the repo

general:
  artifacts:
    - /home/ubuntu/Namak/app/build/reports/tests/debug
    - /home/ubuntu/Namak/app/build/reports/tests/release

machine:
  environment:
    # https://circleci.com/docs/android
    # The SDK is already installed on the VM at /usr/local/android-sdk-linux. This path is exported as $ANDROID_HOME.
    ANDROID_HOME: /home/ubuntu/android
#  java:
#    version: oraclejdk6

dependencies:
  cache_directories:
    - ~/.android
    - ~/android
  pre:
    - echo "Downloading Android SDK and Build Tools"
    - '( export PATH="$ANDROID_HOME/platform-tools:$ANDROID_HOME/tools:$PATH" &&
         export DEPS="$ANDROID_HOME/installed-dependencies" &&
         mkdir $ANDROID_HOME &&
         if [ ! -e $DEPS ]; then
           for i in /usr/local/android-sdk-linux/*; do ln -s $i $ANDROID_HOME/$(basename $i); done &&
           echo "No need for cp -r /usr/local/android-sdk-linux $ANDROID_HOME" &&
           echo y | android update sdk -u -a -t android-23 &&
           echo y | android update sdk -u -a -t build-tools-23.0.1 &&
           echo y | android update sdk -u -a -t sys-img-x86-android-23 &&
           echo no | echo "android create avd -n testAVD -f -t android-23 --abi default/x86" &&
           touch $DEPS ;
         fi )'

#test:
#  pre:
#    - ls /home/ubuntu/android
#  post:
#    - ls -R /home/ubuntu/Namak
#    - find /home/ubuntu -iname '*.apk'
#    - $ANDROID_HOME/tools/emulator -avd testAVD -no-skin -no-audio -no-window:
#        background: true
#    - (./gradlew assembleDebug):
#        timeout: 1200
#    - (./gradlew assembleDebugTest):
#        timeout: 1200
#    - (source scripts/environmentSetup.sh && waitForAVD)
#  override:
#    - (echo "Running JUnit tests!")
#    - (./gradlew connectedAndroidTest)

